                                    Skyjack
                    A Flight Navigation Programming Language

                  Alexander Chang-Davidson and Collin McKinley

--------------------------------------------------------------------------------
                                    Purpose

Flight navigation is a complicated task made worse by a lack of good software.
Skyjack is an alternative to using traditional software to plan flights. Skyjack
uses the power of the Racket programming language to create an easy to use and
familiar macro system for describing a flight plan. It then takes this
description and turns it into data structures which can be used by arbitrary
Racket programs to do operations on these flight plans. Alongside this, Skyjack
will also do rudimentary error checking on flight plans even before they are
generated, allowing for mistakes to be caught early.

--------------------------------------------------------------------------------
                                    Concepts

Skyjack incorporates many concepts from aviation directly into its core design
to make it more familiar to pilots. Some of these concepts can be found below.

Flight Plan:
  A flight plan is a series of positions which comprise a route from one airport
  to another. These positions in the middle may be either other airports or VOR
  navigation aids.

Radio Frequency:
  A radio frequency represents a radio channel which a pilot can tune their
  aircraft radio to in order to either communicate with an air traffic
  controller or to navigate off of. All aircraft radio frequencies are in the
  VHF range between 108.0 MHz and 137.0 MHz. The lowest 10 MHz, 108.0 to 118.0
  are reserved for navigation aids, whereas the rest are used for voice
  communication.

Airports:
  Airports refer to any place where a plane can take off or land. They serve as
  terminals to the flight plan, and are required for a plan to be valid. They
  may also serve as midpoints along a flight. Each airport has a number of radio
  channels which are used to coordinate takeoff, landing, and other functions.
  Airports can also vary in size, which limits what planes can takeoff and land
  there. Airports also have a set GPS location and elevation. This information
  is exposed to Skyjack through the Airport data structure.

VORs:
  VORs are radio way points which comprise the middle parts of a flight plan.
  They are small radio transmitters which send out a signal which is received by
  the aircraft in order to determine direction. VORs have a set radio frequency
  within the VHF aviation radio band. To identify whether or not a pilot has
  tuned to the correct VOR, the VOR transmits a short string of Morse code with
  its identifier. A VOR also has a set of coordinates to where the transmitter
  is housed. This information is exposed to Skyjack through the VOR data
  structure.

--------------------------------------------------------------------------------
                                   Milestones

Milestone 1:
  For our first milestone, we want to get our core data structures for Airports,
  VORs, and flight plans implemented and tested. We would also like to start
  creating functions which can be used to check the feasibility of flight plans
  for future error checking.

Milestone 2:
  For milestone 2, we want to get into more of the language part of the
  programming language. First and foremost we want to get our macros for
  defining a flight plan (define-plan), defining an airport (define-airport),
  and defining a VOR (define-vor) implemented and make sure they are able to
  generate their corresponding data structure. We also want to start working on
  route composition functions and basic output report generation.

Milestone 3:
  For milestone 3, we want to focus on expanding the capabilities of the
  language by allowing for pre-made airport definitions to be loaded in from
  external sources. We also want to implement a beginner friendly syntax for
  easier customization of output reports. We also want to focus on adding new
  arbitrary formats for reports such as PDF or Google Maps. Finally, we want to
  add a new data structure for airplanes, and the corresponding macro
  (define-airplane) in order to perform more error checking and feasibility
  checking.

--------------------------------------------------------------------------------
                                    Grammar

Navigation Point Declarations
  These generally follow the following syntax with each concept having more
  specific key value pair specifications. A nav-id is a unique identifier in
  the form of [A-Z]+ This syntax defines the nav-id as a racket variable and
  adds it to a language global lookup table. Every nav-id defined can only be
  defined once.

    +----------------------------------------------------------------------+
    | (define-<concept> <nav-id> [<key> <values>] ...)                     |
    +----------------------------------------------------------------------+

Airport Declarations
  Airport nav-ids are 4 characters. The size indicates the type of aircraft it
  can support, the radio specifies a map of names to frequencies relevant when
  interacting with it. Coordinates defines the gps latitude and longitude of
  the airport. The elevation of the airport is specified in feet.

    +----------------------------------------------------------------------+
    | (define-airport <nav-id>                                             |
    |                 [country <ISO 3166-1 alpha-2 country code>]          |
    |                 [size <small | medium | large>]                      |
    |                 [radio (<name> <frequency>) ...]                     |
    |                 [coordinates <latitude> <longitude>]                 |
    |                 [elevation <feet>])                                  |
    +----------------------------------------------------------------------+

VOR Declarations
  VOR nav-ids are 3 characters. The power indicates the approximate radius of
  coverage. The coordinates show where the origin of the signal.

    +----------------------------------------------------------------------+
    | (define-vor <nav-id>                                                 |
    |             [country <ISO 3166-1 alpha-2 country code>]              |
    |             [frequency <frequency>]                                  |
    |             [power <low | medium | high>]                            |
    |             [elevation <feet>]                                       |
    |             [coordinates <latitude> <longitude>])                    |
    +----------------------------------------------------------------------+

Flight Plans
  Creates a statically determined flight plan

    +----------------------------------------------------------------------+
    | (define-plan <plan-name> <plan>)                                     |
    |                                                                      |
    | plan := <nav-id or plan-name>                                        |
    |       | <nav-id or plan-name> D-> <plan>                             |
    +----------------------------------------------------------------------+

  Create a runtime checked flight plan. This allows for fully dynamic symbol
  lookup or computed plans. plan-exprs must at runtime resolve to one of
  a NavAid, a previously defined static plan, or a runtime plan structure.

    +----------------------------------------------------------------------+
    | (create-plan <runtime-plan>)                                         |
    |                                                                      |
    | runtime-plan := <nav-id or plan-name or plan-expr>                   |
    |               | <nav-id or plan-name or plan-expr> D-> <runtime-plan>|
    +----------------------------------------------------------------------+

Runtime functions
  nav-lookup : NavId -> [Union NavAid #f]
  get-all-aiports : -> [Hash Symbol NavAid]
  get-all-vors : -> [Hash Symbol NavAid]
  get-navaids-near : Coordinate Distance -> [Hash Symbol NavAid]
  generate-report : Plan -> File

--------------------------------------------------------------------------------
                                    Examples

Simple valid program
    +----------------------------------------------------------------------+
    | (define-airport KBOS                                                 |
    |   [size large]                                                       |
    |   [country US]                                                       |
    |   [radio                                                             |
    |         ("D-ATIS" 135.0)                                             |
    |         ("Tower East" 132.225)                                       |
    |         ("Tower West" 128.8)                                         |
    |         ("Ground" 121.75)                                            |
    |         ("Clearance" 121.65)                                         |
    |         ("Ramp" 134.05)]                                             |
    |   [coordinates 42.36197 -71.0079]                                    |
    |   [elevation 20])                                                    |
    | (define-airport KJFK                                                 |
    |   [country US]                                                       |
    |   [size large]                                                       |
    |   [radio                                                             |
    |         ("D-ATIS" 115.1)                                             |
    |         ("Tower" 119.1)                                              |
    |         ("Tower Alt" 123.9)                                          |
    |         ("Ground" 121.9)                                             |
    |         ("Clearance" 135.05)]                                        |
    |   [coordinates 40.639447 -73.779317]                                 |
    |   [elevation 13])                                                    |
    |                                                                      |
    | (define-vor PVD                                                      |
    |   [country US]                                                       |
    |   [frequency 115.6]                                                  |
    |   [power high]                                                       |
    |   [elevation 49]                                                     |
    |   [coordinates 41.7243003845215 -71.4296035766602])                  |
    | (define-vor ORW                                                      |
    |   [country US]                                                       |
    |   [frequency 110.0]                                                  |
    |   [power high]                                                       |
    |   [elevation 310]                                                    |
    |   [coordinates 41.5564002990723 -71.999397277832])                   |
    | (define-vor CCC                                                      |
    |   [country US]                                                       |
    |   [frequency 117.2]                                                  |
    |   [power medium]                                                     |
    |   [elevation 86]                                                     |
    |   [coordinates 40.9295997619629 -72.7988967895508])                  |
    |                                                                      |
    | (define-plan boston-to-new-york-city                                 |
    |       KBOS                                                           |
    |   D-> PVD                                                            |
    |   D-> ORW                                                            |
    |   D-> CCC                                                            |
    |   D-> KJFK)                                                          |
    |                                                                      |
    | (define generate-report                                              |
    |   (make-text-report-generator                                        |
    |     [airport name]                                                   |
    |     [vor name]))                                                     |
    |                                                                      |
    | (generate-report boston-to-new-york-city)                            |
    +----------------------------------------------------------------------+

Program with compile time errors, but syntactically valid
    +----------------------------------------------------------------------+
    | (define-airport KBOS                                                 |
    |   [country US]                                                       |
    |   [size large]                                                       |
    |   [radio                                                             |
    |         ("D-ATIS" 135.0)                                             |
    |         ("Tower East" 132.225)                                       |
    |         ("Tower West" 128.8)                                         |
    |         ("Ground" 121.75)                                            |
    |         ("Clearance" 121.65)                                         |
    |         ("Ramp" 134.05)]                                             |
    |   [coordinates 42.36197 -71.0079]                                    |
    |   [elevation 20])                                                    |
    | (define-airport KBGR                                                 |
    |   [country US]                                                       |
    |   [size medium]                                                      |
    |   [radio                                                             |
    |         ("D-ATIS" 127.75)                                            |
    |         ("Tower" 120.7)                                              |
    |         ("Ground" 121.9)                                             |
    |         ("Clearance" 135.9)]                                         |
    |   [coordinates 44.8074 -68.828102]                                   |
    |   [elevation 192])                                                   |
    | (define-airport KCON                                                 |
    |   [country US]                                                       |
    |   [size medium]                                                      |
    |   [radio                                                             |
    |         ("Approach/Departure" 127.35)                                |
    |         ("Clearance" 133.65)                                         |
    |         ("Bangor RDO" 122.3)]                                        |
    |   [coordinates 43.20270157 -71.50229645]                             |
    |   [elevation 342])                                                   |
    |                                                                      |
    | (define-vor PSM                                                      |
    |   [country US]                                                       |
    |   [frequency 116.5]                                                  |
    |   [power medium]                                                     |
    |   [elevation 99]                                                     |
    |   [coordinates 43.0844993591309 -70.8320007324219])                  |
    | (define-vor ENE                                                      |
    |   [country US]                                                       |
    |   [frequency 117.1]                                                  |
    |   [power high]                                                       |
    |   [elevation 190]                                                    |
    |   [coordinates 43.4257011413574 -70.6135025024414])                  |
    | (define-vor AUG                                                      |
    |   [country US]                                                       |
    |   [frequency 111.4]                                                  |
    |   [power medium]                                                     |
    |   [elevation 349]                                                    |
    |   [coordinates 44.3199996948242 -69.7966003417969])                  |
    | (define-vor BGR                                                      |
    |   [country US]                                                       |
    |   [frequency 114.8]                                                  |
    |   [power high]                                                       |
    |   [elevation 359]                                                    |
    |   [coordinates 44.8418006896973 -68.8740005493164])                  |
    | (define-vor SFO                                                      |
    |   [country US]                                                       |
    |   [frequency 115.8]                                                  |
    |   [power medium]                                                     |
    |   [elevation 13]                                                     |
    |   [coordinates 37.619499206543 -122.374000549316])                   |
    | (define-vor CON                                                      |
    |   [country US]                                                       |
    |   [frequency 112.9]                                                  |
    |   [power medium]                                                     |
    |   [elevation 710]                                                    |
    |   [coordinates 43.2197990417481 -71.5755004882813])                  |
    |                                                                      |
    | (define-plan boston-north-departure                                  |
    |       KBOS                                                           |
    |   D-> PSM)                                                           |
    |                                                                      |
    | (define-plan boston-to-bangor                                        |
    |       boston-north-departure                                         |
    |   D-> ENE                                                            |
    |   D-> AUG                                                            |
    |   D-> BGR                                                            |
    |   D-> SFO                                                            |
    |   D-> KBGR)                                                          |
    |                                                                      |
    | (define-plan boston-to-concord                                       |
    |       boston-north-departure                                         |
    |   D-> CON                                                            |
    |   D-> KCON)                                                          |
    |                                                                      |
    | (define generate-report                                              |
    |   (make-text-report-generator                                        |
    |     [airport name]                                                   |
    |     [vor name]))                                                     |
    |                                                                      |
    | (generate-report boston-to-bangor)                                   |
    | (generate-report boston-to-concord)                                  |
    +----------------------------------------------------------------------+
